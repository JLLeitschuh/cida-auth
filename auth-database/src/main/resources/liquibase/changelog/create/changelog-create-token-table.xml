<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet author="${runasusername}" id="create-token-table">
		<createTable 
			remarks="Holds active tokens, expiration times and associated metadata"
			tableName="AUTH_TOKEN">
			<column name="ID" type="BIGINT" autoIncrement="true" >
				<constraints 
					nullable="false" 
					primaryKey="true" 
					primaryKeyName="pk_ID" 
				/>
			</column>
			<column name="TOKEN_ID" type="java.sql.Types.VARCHAR(256)" />
			<column name="USERNAME" type="java.sql.Types.VARCHAR(64)" />
			<column name="ISSUED" type="java.sql.Types.TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP" />
			<column name="EXPIRES" type="java.sql.Types.TIMESTAMP" />
			<column name="LAST_ACCESS" type="java.sql.Types.TIMESTAMP" />
		</createTable>
    
		<sql>Grant Select On ${db.auth.schemaname}.AUTH_TOKEN To ${db.auth.user};</sql>
		<sql>Grant Insert On ${db.auth.schemaname}.AUTH_TOKEN To ${db.auth.user};</sql>
		<sql>Grant Delete On ${db.auth.schemaname}.AUTH_TOKEN To ${db.auth.user};</sql>
		<sql>Grant Update On ${db.auth.schemaname}.AUTH_TOKEN To ${db.auth.user};</sql>
    
		<rollback>
			drop table ${db.auth.schemaname}.AUTH_TOKEN;
		</rollback>
	</changeSet>
</databaseChangeLog>
